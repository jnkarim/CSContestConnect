@using CSContestConnect.Web.ViewModels
@model AdminDashboardVm

@{
    ViewData["Title"] = "Dashboard";
}

<div class="d-flex align-items-center justify-content-between mb-4">
    <h2 class="text-accent mb-0">@ViewData["Title"]</h2>
</div>

<!-- KPI cards -->
<div class="row g-3 mb-4">
    <div class="col-6 col-md-3"><div class="card bg-dark border-0 shadow-sm h-100"><div class="card-body"><div class="text-muted small">Total</div><div class="fs-3 fw-semibold">@Model.Total</div></div></div></div>
    <div class="col-6 col-md-3"><div class="card bg-dark border-0 shadow-sm h-100"><div class="card-body"><div class="text-muted small">Pending</div><div class="fs-3 fw-semibold text-warning">@Model.Pending</div></div></div></div>
    <div class="col-6 col-md-3"><div class="card bg-dark border-0 shadow-sm h-100"><div class="card-body"><div class="text-muted small">Approved</div><div class="fs-3 fw-semibold text-success">@Model.Approved</div></div></div></div>
    <div class="col-6 col-md-3"><div class="card bg-dark border-0 shadow-sm h-100"><div class="card-body"><div class="text-muted small">Rejected</div><div class="fs-3 fw-semibold text-danger">@Model.Rejected</div></div></div></div>
</div>

<!-- Weekly activity -->
<div class="row g-3 mb-4">
    <div class="col-6 col-md-3"><div class="card bg-dark border-0 shadow-sm h-100"><div class="card-body"><div class="text-muted small">New this week</div><div class="fs-4 fw-semibold">@Model.NewThisWeek</div></div></div></div>
    <div class="col-6 col-md-3"><div class="card bg-dark border-0 shadow-sm h-100"><div class="card-body"><div class="text-muted small">Approved this week</div><div class="fs-4 fw-semibold text-success">@Model.ApprovedThisWeek</div></div></div></div>
</div>

<div class="row g-4">
    <div class="col-12 col-lg-6">
        <div class="card bg-dark border-0 shadow-sm">
            <div class="card-header table-accent fw-semibold">Latest submissions</div>
            <div class="card-body p-0">
                @if (!Model.Latest.Any()) { <div class="p-4 text-muted">No events yet.</div> }
                else {
                    <div class="table-responsive">
                        <table class="table table-dark table-hover align-middle mb-0">
                            <thead><tr><th>Title</th><th>Status</th><th>Author</th><th>Created</th></tr></thead>
                            <tbody>
                            @foreach (var e in Model.Latest)
                            {
                                var badge = e.ApprovalStatus switch
                                {
                                    EventApprovalStatus.Pending => "badge bg-warning text-dark",
                                    EventApprovalStatus.Approved => "badge bg-success",
                                    _ => "badge bg-danger"
                                };
                                <tr>
                                    <td class="fw-semibold">@e.Title</td>
                                    <td><span class="@badge">@e.ApprovalStatus</span></td>
                                    <td>@(e.CreatedBy?.Email ?? e.CreatedById)</td>
                                    <td>@e.CreatedAt.ToLocalTime():g</td>
                                </tr>
                            }
                            </tbody>
                        </table>
                    </div>
                }
            </div>
        </div>
    </div>
    <div class="col-12 col-lg-6">
        <div class="card bg-dark border-0 shadow-sm">
            <div class="card-header table-accent fw-semibold">Upcoming (approved)</div>
            <div class="card-body p-0">
                @if (!Model.UpcomingApproved.Any()) { <div class="p-4 text-muted">No upcoming approved events.</div> }
                else {
                    <div class="table-responsive">
                        <table class="table table-dark table-hover align-middle mb-0">
                            <thead><tr><th>Title</th><th>When (local)</th><th>Author</th></tr></thead>
                            <tbody>
                            @foreach (var e in Model.UpcomingApproved)
                            {
                                <tr>
                                    <td class="fw-semibold">@e.Title</td>
                                    <td>@e.StartsAt.ToLocalTime():g â€“ @e.EndsAt.ToLocalTime():g</td>
                                    <td>@(e.CreatedBy?.Email ?? e.CreatedById)</td>
                                </tr>
                            }
                            </tbody>
                        </table>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .table-accent { background-color: #2d033b; color: #fff; }
        .text-accent { color: #a020f0 !important; }
        .card.bg-dark { background-color: #1a1a1a !important; }
    </style>
}
